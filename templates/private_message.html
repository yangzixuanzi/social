<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <title>金融岛-打开财富之门</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <link rel="bookmark" href="../images/favicon.ico">
    <link rel="shortcut icon" href="../images/favicon.ico"/>
</head>
<body>
{% include 'commons/body_top.html' %}
<div id="body">
    <div class="cards">
        {%if to_user%}
        <input id="chatWith" type="hidden" value="{{to_user.id}}"/>
        {% else %}
        {%if user_list%}
        <input id="chatWith" type="hidden" value="{{user_list[0].id}}"/>
        {%endif%}
        {%endif%}
        <div class="webim">
            <div class="friend-container">
                <div class="container-scroll" style="height:100%;">
                    <ul class="friend-list">
                        {%if to_user%}
                        <li id="u_{{to_user.id}}" onclick="getUserPrivateMessage({{to_user.id}})">
                            <span><img src="{{to_user.head_img_url}}"></span><span>{{to_user.name}}</span>
                        </li>
                        {%endif%}
                        {% if user_list and unread_count_list%}
                        {% for i in range(user_num)%}
                        <li id="u_{{user_list[i].id}}" onclick="getUserPrivateMessage({{user_list[i].id}})">
                            <span><img src="{{user_list[i].head_img_url}}"></span>
                            <span>{{user_list[i].name}}
                            {%if unread_count_list[i] %}
                            <b class="circle_sm">{{unread_count_list[i]}}</b>
                            {%endif%}
                            </span>
                        </li>
                        {% endfor %}
                        {% endif%}
                    </ul>
                </div>
            </div>
            <div class="chat-container">
                <div class="chat">
                    <div class="container-scroll">
                        <div class="chat-date">{{today}}</div>
                        <div class="scroll-data">
                            <div class="scroll-data-inner">
                                <ul id="containerScroll">
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="chat-footer">
                    <div class="chat-tool btn-toolbar-smile-editor"><span class="emotion"></span><span
                            class="pull-right"><i class="icon-history"></i></span></div>
                    <div class="chat-textarea">
                        <textarea class="textarea-control" operate-type="smile-editor" rows="3" placeholder=""
                                  data-emojiable="true"></textarea>
                    </div>
                    <div class="chat-action">
                        <button id="send" class="btn btn-primary">发送</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
{% include 'commons/footer.html' %}
{% include 'commons/common.html' %}
<script src="../lib/js/privatemessage.js "></script>
<script src="../lib/jquery.mousewheel.all.min.js"></script>
<script src="../lib/scrollbar.js"></script>
<script>
var to_user_id =$('#chatWith').val();
//页面初始化
var pageNo=1;
var pageNum=10
var scroll_bottom = false;
initData();
var Scrollbar;
//点击用户，加载此用户的对话信息
function getUserPrivateMessage(toUserId){
    to_user_id = toUserId;
    pageNo=1;
    $('#chatWith').val(toUserId);
    $('#containerScroll').empty();
    $(".friend-list>li").removeClass('active');
    $('.friend-list>li#u_'+toUserId).addClass('active');
    getHistoryMessage(toUserId);
}
$(function(){
    getHistoryMessage(to_user_id);
    Scrollbar = $('.scroll-data').scrollbar({
            autoBottom: false,//内容改变，是否自动滚动到底部
            backClass: 'SC_backClass',
            frontClass: 'bodyFrontClass',
            moveCallback: function(top, direction) {//运动时事件回调
                if(top==0 && has_next){
                    pageNo = pageNo + 1;
                    getHistoryMessage(to_user_id);
                }
            }
    });
})
$(function() {
    // Initializes and creates emoji set from sprite sheet
    window.emojiPicker = new EmojiPicker({
      emojiable_selector: '[data-emojiable=true]',
      assetsPath: 'images/img/',
      popupButtonClasses: 'fa fa-smile-o'
    });
    // Finds all elements with `emojiable_selector` and converts them to rich emoji input fields
    // You may want to delay this step if you have dynamically created input fields that appear later in the loading process
    // It can be called as many times as necessary; previously converted input fields will not be converted again
    window.emojiPicker.discover();
  });

</script>
<script>
  <!--// Google Analytics-->
  <!--(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){-->
  <!--(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),-->
  <!--m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)-->
  <!--})(window,document,'script','//www.google-analytics.com/analytics.js','ga');-->
  <!--ga('create', 'UA-49610253-3', 'auto');-->
  <!--ga('send', 'pageview');-->

</script>
</body>
</html>
<style>
.emoji-menu {
    left: 5px;
    bottom:110px;
}

</style>
